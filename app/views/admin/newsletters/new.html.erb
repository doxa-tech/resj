<h1>Newsletter</h1>

<%= form_tag admin_newsletters_path do %>

	<ul>
		<li><%= text_field_tag :subject, nil, placeholder: "Sujet" %></li>

		<li><%= text_area_tag :content, nil, class: "ckeditor" %></li>

		<li><%= select_tag :emails, grouped_options_for_select([["Orateurs", map_users(@orators)], ["PropriÃ©taires", map_users(@owners)], ["Responables", map_users(@resps)], ["Utilisateurs", map_users(@users)]]), multiple: true, id: "email-select" %></li>
		<li><%= submit_tag "Envoyer", data: {confirm: "Confirmez-vous l'envoi de cette newsletter ?"} %></li>
	</ul>

<% end %>

<%= javascript_include_tag "jquery.quicksearch.js" %>
<script type="text/javascript">
$(function() {
	$('#email-select').multiSelect({
		selectableOptgroup: true,
	  selectableHeader: "<input type='text' class='search-input' autocomplete='off'>",
	  selectionHeader: "<input type='text' class='search-input' autocomplete='off'>",
	  afterInit: function(ms){
	    var that = this,
	        $selectableSearch = that.$selectableUl.prev(),
	        $selectionSearch = that.$selectionUl.prev(),
	        selectableSearchString = '#'+that.$container.attr('id')+' .ms-elem-selectable:not(.ms-selected)',
	        selectionSearchString = '#'+that.$container.attr('id')+' .ms-elem-selection.ms-selected';

	    that.qs1 = $selectableSearch.quicksearch(selectableSearchString)
	    .on('keydown', function(e){
	      if (e.which === 40){
	        that.$selectableUl.focus();
	        return false;
	      }
	    });

	    that.qs2 = $selectionSearch.quicksearch(selectionSearchString)
	    .on('keydown', function(e){
	      if (e.which == 40){
	        that.$selectionUl.focus();
	        return false;
	      }
	    });
	  },
	  afterSelect: function(){
	    this.qs1.cache();
	    this.qs2.cache();
	  },
	  afterDeselect: function(){
	    this.qs1.cache();
	    this.qs2.cache();
	  }
	});
});
</script>
