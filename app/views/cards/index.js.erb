$('#results .left-content').html('<%= j render "results_l" %>');

/* Description */
$('#container.cards .index .description').hide();
$('#container.cards .show-description').click(function(){
  var btn = $(this)
  var el = btn.next().next();
  if(el.css("display")=="none") {
    btn.css("color", "rgba(39,40,41,1)");
  } else {
    btn.css("color", "rgba(39,40,41,.6)");
  }
  el.slideToggle();
});


// Reset the map
load_mapbox.markers.clearLayers();
load_mapbox.map.removeLayer(load_mapbox.markers);

// Add the cards
<% @cards_map.each do |card| %>
<% title = j map_point_title(card).html_safe %>
	var marker = L.marker(new L.LatLng(<%= card.latitude %>, <%= card.longitude %>), options={
    icon: L.icon({
      iconUrl: "<%= map_point_icon(card) %>",
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [0, -30],
      shadowUrl: '<%= asset_path "map/images/marker-shadow.png" %>',
      shadowSize: [41, 41],
      shadowAnchor: [12, 41]
    }),
		title: "<%= title %>",
    riseOnHover: true,
    id: <%= card.id %>,
	});
	load_mapbox.markers.addLayer(marker);
	marker.bindPopup("<%= title %>");
<% end %>
// Add icons, position the map
load_mapbox.map.addLayer(load_mapbox.markers);
load_mapbox.map.fitBounds(load_mapbox.markers.getBounds());

// Show marker when click
$('.show-on-map').click(function(){
  var link = $(this);
  document.getElementById('map').scrollIntoView();
  load_mapbox.markers.eachLayer(function(layer){
    if(layer.options.id == parseInt(link.data("id"))) {
      load_mapbox.markers.zoomToShowLayer(layer, function() {
        layer.openPopup();
      });
    }
  });
});