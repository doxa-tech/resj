$('#results .left-content').html('<%= j render "results_l" %>');

/* Description */
$('#container.cards .index .description').hide();
$('#container.cards .show-description').click(function(){
  var btn = $(this)
  var el = btn.next().next();
  if(el.css("display")=="none") {
    btn.css("color", "rgba(39,40,41,1)");
  } else {
    btn.css("color", "rgba(39,40,41,.6)");
  }
  el.slideToggle();
});


// Reset the map
load_mapbox.markers.clearLayers();
load_mapbox.map.removeLayer(load_mapbox.markers);

// Add the cards
<% @cards_map.each do |card| %>
<% title = j render('cards/map_popup', card: card) %>
	var marker = L.marker(new L.LatLng(<%= card.latitude %>, <%= card.longitude %>), options={
    icon: L.icon({
      iconUrl: "<%= map_point_icon(card) %>",
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [0, -30],
      shadowUrl: '<%= asset_path "map/images/marker-shadow.png" %>',
      shadowSize: [41, 41],
      shadowAnchor: [12, 41]
    }),
		title: "Qui est l√†?",
    riseOnHover: true,
    id: <%= card.id %>,
    open_network: true,
	});
	load_mapbox.markers.addLayer(marker);
	marker.bindPopup("<%= title %>");
  // Network links, selft invoking to keep marker variable "local"
  (function(marker){
    console.log("sdf");
    if(<%= card.network? %> == 1) {
      var polyline_options = {
        color: '#000',
        weight: 3,
      };
      $("#map").on('click', "#net-toggle-<%= card.id %>", function(){
        if(marker.options.open_network) {
          marker.options.open_network = false;
          marker.options.polylines = L.polyline(<%= card.network_members_coords %>, polyline_options).addTo(load_mapbox.map);
          $(this).find(".a").html("Masquer");
        } else {
          marker.options.open_network = true;
          load_mapbox.map.removeLayer(marker.options.polylines);
          $(this).find(".a").html("Afficher");
        }
      });
    }
  })(marker);
<% end %>
// Add icons, position the map
load_mapbox.map.addLayer(load_mapbox.markers);
load_mapbox.map.fitBounds(load_mapbox.markers.getBounds());

// Show marker when click
$('.show-on-map').click(function(){
  var link = $(this);
  document.getElementById('map').scrollIntoView();
  load_mapbox.markers.eachLayer(function(layer){
    if(layer.options.id == parseInt(link.data("id"))) {
      load_mapbox.markers.zoomToShowLayer(layer, function() {
        layer.openPopup();
      });
    }
  });
});